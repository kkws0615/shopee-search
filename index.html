<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„ç¾é£Ÿé›·é”</title>
    <style>
        /* é€™è£¡æ˜¯ç¶²é çš„åŒ–å¦å¸« (CSS)ï¼Œè¨­å®šå¤–è§€ */
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { width: 70%; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; }
        button { width: 25%; padding: 10px; font-size: 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #map { width: 100%; height: 300px; margin-top: 20px; border-radius: 5px; display:none; }
        ul { list-style: none; padding: 0; }
        li { background: #fff; border-bottom: 1px solid #eee; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .rating { background: #ffc107; padding: 5px 10px; border-radius: 15px; font-weight: bold; color: #333; }
        .info h3 { margin: 0 0 5px; font-size: 18px; }
        .info p { margin: 0; color: #666; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center">ğŸ” 3å…¬é‡Œå…§æœ€å¼·é¤å»³æœå°‹</h2>
    <div style="display:flex; justify-content:space-between;">
        <input type="text" id="address" placeholder="è¼¸å…¥åœ°é» (ä¾‹å¦‚: å°åŒ—101, æ¿æ©‹è»Šç«™)">
        <button onclick="findFood()">æœå°‹</button>
    </div>
    <div id="status" style="text-align:center; margin-top:10px; color:gray;"></div>
    <div id="map"></div>
    <ul id="list"></ul>
</div>

<script>
    // ğŸ‘‡ è«‹å°‡ä½ çš„ API Key è²¼åœ¨ä¸‹é¢é€™å…©å€‹å¼•è™Ÿä¸­é–“ ğŸ‘‡
    const MY_API_KEY = "åœ¨æ­¤è™•è²¼ä¸Šä½ çš„API_KEY"; 
</script>

<script>
    // å‹•æ…‹è¼‰å…¥ Google Maps è…³æœ¬
    function loadScript() {
        if(MY_API_KEY === "åœ¨æ­¤è™•è²¼ä¸Šä½ çš„API_KEY" || MY_API_KEY.length < 10) {
            alert("âš ï¸ éŒ¯èª¤ï¼šä½ å¿˜è¨˜è²¼ä¸Š API Key äº†ï¼\nè«‹æ‰“é–‹æª”æ¡ˆï¼Œæ‰¾åˆ° 'MY_API_KEY' è™•è²¼ä¸Šã€‚");
            return;
        }
        const script = document.createElement('script');
        script.src = `https://maps.googleapis.com/maps/api/js?key=${MY_API_KEY}&libraries=places&language=zh-TW`;
        script.onload = () => console.log("Google Maps API Loaded");
        document.head.appendChild(script);
    }
    loadScript();

    let map, service, geocoder;

    function findFood() {
        const address = document.getElementById('address').value;
        const status = document.getElementById('status');
        const list = document.getElementById('list');
        const mapDiv = document.getElementById('map');

        if(!address) return alert("è«‹è¼¸å…¥åœ°é»ï¼");
        
        status.innerText = "ğŸ“ æ­£åœ¨å®šä½ä¸¦æœå°‹ä¸­...";
        list.innerHTML = "";
        
        if(!google || !google.maps) {
            return alert("åœ°åœ– API å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢ºã€‚");
        }

        // 1. æŠŠåœ°å€è®Šåº§æ¨™
        geocoder = new google.maps.Geocoder();
        geocoder.geocode({ 'address': address }, function(results, statusText) {
            if (statusText === 'OK') {
                const location = results[0].geometry.location;
                
                // é¡¯ç¤ºåœ°åœ–
                mapDiv.style.display = "block";
                map = new google.maps.Map(mapDiv, { center: location, zoom: 15 });
                service = new google.maps.places.PlacesService(map);

                // 2. æœå°‹é™„è¿‘é¤å»³ (åŠå¾‘ 3000 å…¬å°º)
                service.nearbySearch({
                    location: location,
                    radius: 3000,
                    type: ['restaurant']
                }, (results, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        status.innerText = `âœ… æ‰¾åˆ° ${results.length} é–“é¤å»³ï¼Œä¾è©•åƒ¹æ’åºï¼š`;
                        
                        // 3. æ’åºï¼šé«˜åˆ†åœ¨ä¸Šé¢
                        results.sort((a, b) => (b.rating || 0) - (a.rating || 0));

                        // 4. é¡¯ç¤ºçµæœ
                        results.forEach(place => {
                            const item = document.createElement('li');
                            const rating = place.rating ? place.rating : "ç„¡";
                            item.innerHTML = `
                                <div class="info">
                                    <h3>${place.name}</h3>
                                    <p>${place.vicinity}</p>
                                </div>
                                <div class="rating">â˜… ${rating}</div>
                            `;
                            list.appendChild(item);
                            
                            // åœ°åœ–ä¸Šæ’æ——å­
                            new google.maps.Marker({
                                map: map, position: place.geometry.location, title: place.name
                            });
                        });
                    } else {
                        status.innerText = "âŒ é™„è¿‘æ‰¾ä¸åˆ°é¤å»³ï¼Œæˆ– API ç™¼ç”ŸéŒ¯èª¤ã€‚";
                    }
                });
            } else {
                alert('æ‰¾ä¸åˆ°é€™å€‹åœ°é»ï¼Œè«‹è©¦è©¦çœ‹åˆ¥çš„é—œéµå­—ã€‚éŒ¯èª¤ç¢¼: ' + statusText);
                status.innerText = "";
            }
        });
    }
</script>

</body>
</html>
